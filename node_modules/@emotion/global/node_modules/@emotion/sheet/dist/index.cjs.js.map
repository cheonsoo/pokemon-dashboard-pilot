{"version":3,"file":"index.cjs.js","sources":["../src/index.js"],"sourcesContent":["// @flow\n/*\n\nhigh performance StyleSheet for css-in-js systems\n\n- uses multiple style tags behind the scenes for millions of rules\n- uses `insertRule` for appending in production for *much* faster performance\n- 'polyfills' on server side\n\n// usage\n\nimport StyleSheet from 'glamor/lib/sheet'\nlet styleSheet = new StyleSheet()\n\nstyleSheet.inject()\n- 'injects' the stylesheet into the page (or into memory if on server)\n\nstyleSheet.insert('#box { border: 1px solid red; }')\n- appends a css rule into the stylesheet\n\nstyleSheet.flush()\n- empties the stylesheet of all its contents\n\n*/\n\n// $FlowFixMe\nfunction sheetForTag(tag: HTMLStyleElement): CSSStyleSheet {\n  if (tag.sheet) {\n    // $FlowFixMe\n    return tag.sheet\n  }\n\n  // this weirdness brought to you by firefox\n  /* istanbul ignore next */\n  for (let i = 0; i < document.styleSheets.length; i++) {\n    if (document.styleSheets[i].ownerNode === tag) {\n      // $FlowFixMe\n      return document.styleSheets[i]\n    }\n  }\n}\n\nexport type Options = {\n  nonce?: string,\n  key?: string,\n  container?: HTMLElement,\n  speedy?: boolean,\n  maxLength?: number\n}\n\nexport class StyleSheet {\n  isSpeedy: boolean\n  ctr: number\n  tags: HTMLStyleElement[]\n  container: HTMLElement\n  maxLength: number\n  key: string\n  nonce: string | void\n  constructor(options: Options | void) {\n    if (options === undefined) options = {}\n    this.isSpeedy =\n      options.speedy === undefined\n        ? process.env.NODE_ENV === 'production'\n        : options.speedy\n    // maxLength is how many rules we have per style tag, it's 65000 in speedy mode\n    // because that's the upper limit in IE 10 TODO: make sure that is actually correct\n    // it's 1 in dev because we insert source maps that map a single rule to a location\n    // and you can only have one source map per style tag\n    this.maxLength = options.maxLength || this.isSpeedy ? 65000 : 1\n    this.tags = []\n    this.ctr = 0\n    this.nonce = options.nonce\n    // key is the value of the data-emotion attribute, it's used to identify different sheets\n    this.key = options.key || ''\n    this.container =\n      options.container ||\n      // $FlowFixMe\n      (typeof document !== 'undefined' ? document.head : null)\n  }\n  insert(rule: string) {\n    if (this.ctr % this.maxLength === 0) {\n      let tag = document.createElement('style')\n      tag.setAttribute('data-emotion', this.key)\n      if (this.nonce !== undefined) {\n        tag.setAttribute('nonce', this.nonce)\n      }\n      tag.appendChild(document.createTextNode(''))\n      this.container.appendChild(tag)\n      this.tags.push(tag)\n    }\n    const tag = this.tags[this.tags.length - 1]\n\n    if (this.isSpeedy) {\n      const sheet = sheetForTag(tag)\n      try {\n        // this is the ultrafast version, works across browsers\n        // the big drawback is that the css won't be editable in devtools\n        sheet.insertRule(rule, sheet.cssRules.length)\n      } catch (e) {\n        if (process.env.NODE_ENV !== 'production') {\n          console.warn(\n            `There was a problem inserting the following rule: \"${rule}\"`,\n            e\n          )\n        }\n      }\n    } else {\n      tag.appendChild(document.createTextNode(rule))\n    }\n    this.ctr++\n  }\n  flush() {\n    // $FlowFixMe\n    this.tags.forEach(tag => tag.parentNode.removeChild(tag))\n    this.tags = []\n    this.ctr = 0\n  }\n}\n"],"names":["sheetForTag","tag","sheet","i","document","styleSheets","length","ownerNode","StyleSheet","options","undefined","isSpeedy","speedy","process","env","NODE_ENV","maxLength","tags","ctr","nonce","key","container","head","insert","rule","createElement","setAttribute","appendChild","createTextNode","push","insertRule","cssRules","e","warn","flush","forEach","parentNode","removeChild"],"mappings":";;;;AACA;;;;;;;;;;;;;;;;;;;;;;;;AAyBA,SAASA,WAAT,CAAqBC,GAArB,EAA2D;MACrDA,IAAIC,KAAR,EAAe;;WAEND,IAAIC,KAAX;GAHuD;;;;;OAQpD,IAAIC,IAAI,CAAb,EAAgBA,IAAIC,SAASC,WAAT,CAAqBC,MAAzC,EAAiDH,GAAjD,EAAsD;QAChDC,SAASC,WAAT,CAAqBF,CAArB,EAAwBI,SAAxB,KAAsCN,GAA1C,EAA+C;;aAEtCG,SAASC,WAAT,CAAqBF,CAArB,CAAP;;;;;AAaN,IAAaK,UAAb;;AAAA;sBAQcC,OAAZ,EAAqC;QAC/BA,YAAYC,SAAhB,EAA2BD,UAAU,EAAV;SACtBE,QAAL,GACEF,QAAQG,MAAR,KAAmBF,SAAnB,GACIG,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,YAD7B,GAEIN,QAAQG,MAHd,CAFmC;;;;;SAU9BI,SAAL,GAAiBP,QAAQO,SAAR,IAAqB,KAAKL,QAA1B,GAAqC,KAArC,GAA6C,CAA9D;SACKM,IAAL,GAAY,EAAZ;SACKC,GAAL,GAAW,CAAX;SACKC,KAAL,GAAaV,QAAQU,KAArB,CAbmC;;SAe9BC,GAAL,GAAWX,QAAQW,GAAR,IAAe,EAA1B;SACKC,SAAL,GACEZ,QAAQY,SAAR;WAEQjB,QAAP,KAAoB,WAApB,GAAkCA,SAASkB,IAA3C,GAAkD,IAFnD,CADF;;;;;SAKFC,MA7BF,mBA6BSC,IA7BT,EA6BuB;QACf,KAAKN,GAAL,GAAW,KAAKF,SAAhB,KAA8B,CAAlC,EAAqC;UAC/Bf,OAAMG,SAASqB,aAAT,CAAuB,OAAvB,CAAV;;WACIC,YAAJ,CAAiB,cAAjB,EAAiC,KAAKN,GAAtC;;UACI,KAAKD,KAAL,KAAeT,SAAnB,EAA8B;aACxBgB,YAAJ,CAAiB,OAAjB,EAA0B,KAAKP,KAA/B;;;WAEEQ,WAAJ,CAAgBvB,SAASwB,cAAT,CAAwB,EAAxB,CAAhB;;WACKP,SAAL,CAAeM,WAAf,CAA2B1B,IAA3B;WACKgB,IAAL,CAAUY,IAAV,CAAe5B,IAAf;;;QAEIA,MAAM,KAAKgB,IAAL,CAAU,KAAKA,IAAL,CAAUX,MAAV,GAAmB,CAA7B,CAAZ;;QAEI,KAAKK,QAAT,EAAmB;UACXT,QAAQF,YAAYC,GAAZ,CAAd;;UACI;;;cAGI6B,UAAN,CAAiBN,IAAjB,EAAuBtB,MAAM6B,QAAN,CAAezB,MAAtC;OAHF,CAIE,OAAO0B,CAAP,EAAU;YACNnB,QAAQC,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;kBACjCkB,IAAR,0DACwDT,IADxD,SAEEQ,CAFF;;;KARN,MAcO;UACDL,WAAJ,CAAgBvB,SAASwB,cAAT,CAAwBJ,IAAxB,CAAhB;;;SAEGN,GAAL;GA3DJ;;SA6DEgB,KA7DF,oBA6DU;;SAEDjB,IAAL,CAAUkB,OAAV,CAAkB;aAAOlC,IAAImC,UAAJ,CAAeC,WAAf,CAA2BpC,GAA3B,CAAP;KAAlB;SACKgB,IAAL,GAAY,EAAZ;SACKC,GAAL,GAAW,CAAX;GAjEJ;;;;;;;"}