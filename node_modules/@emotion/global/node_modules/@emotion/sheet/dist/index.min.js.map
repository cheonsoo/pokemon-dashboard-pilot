{"version":3,"file":"index.min.js","sources":["../src/index.js"],"sourcesContent":["// @flow\n/*\n\nhigh performance StyleSheet for css-in-js systems\n\n- uses multiple style tags behind the scenes for millions of rules\n- uses `insertRule` for appending in production for *much* faster performance\n- 'polyfills' on server side\n\n// usage\n\nimport StyleSheet from 'glamor/lib/sheet'\nlet styleSheet = new StyleSheet()\n\nstyleSheet.inject()\n- 'injects' the stylesheet into the page (or into memory if on server)\n\nstyleSheet.insert('#box { border: 1px solid red; }')\n- appends a css rule into the stylesheet\n\nstyleSheet.flush()\n- empties the stylesheet of all its contents\n\n*/\n\n// $FlowFixMe\nfunction sheetForTag(tag: HTMLStyleElement): CSSStyleSheet {\n  if (tag.sheet) {\n    // $FlowFixMe\n    return tag.sheet\n  }\n\n  // this weirdness brought to you by firefox\n  /* istanbul ignore next */\n  for (let i = 0; i < document.styleSheets.length; i++) {\n    if (document.styleSheets[i].ownerNode === tag) {\n      // $FlowFixMe\n      return document.styleSheets[i]\n    }\n  }\n}\n\nexport type Options = {\n  nonce?: string,\n  key?: string,\n  container?: HTMLElement,\n  speedy?: boolean,\n  maxLength?: number\n}\n\nexport class StyleSheet {\n  isSpeedy: boolean\n  ctr: number\n  tags: HTMLStyleElement[]\n  container: HTMLElement\n  maxLength: number\n  key: string\n  nonce: string | void\n  constructor(options: Options | void) {\n    if (options === undefined) options = {}\n    this.isSpeedy =\n      options.speedy === undefined\n        ? process.env.NODE_ENV === 'production'\n        : options.speedy\n    // maxLength is how many rules we have per style tag, it's 65000 in speedy mode\n    // because that's the upper limit in IE 10 TODO: make sure that is actually correct\n    // it's 1 in dev because we insert source maps that map a single rule to a location\n    // and you can only have one source map per style tag\n    this.maxLength = options.maxLength || this.isSpeedy ? 65000 : 1\n    this.tags = []\n    this.ctr = 0\n    this.nonce = options.nonce\n    // key is the value of the data-emotion attribute, it's used to identify different sheets\n    this.key = options.key || ''\n    this.container =\n      options.container ||\n      // $FlowFixMe\n      (typeof document !== 'undefined' ? document.head : null)\n  }\n  insert(rule: string) {\n    if (this.ctr % this.maxLength === 0) {\n      let tag = document.createElement('style')\n      tag.setAttribute('data-emotion', this.key)\n      if (this.nonce !== undefined) {\n        tag.setAttribute('nonce', this.nonce)\n      }\n      tag.appendChild(document.createTextNode(''))\n      this.container.appendChild(tag)\n      this.tags.push(tag)\n    }\n    const tag = this.tags[this.tags.length - 1]\n\n    if (this.isSpeedy) {\n      const sheet = sheetForTag(tag)\n      try {\n        // this is the ultrafast version, works across browsers\n        // the big drawback is that the css won't be editable in devtools\n        sheet.insertRule(rule, sheet.cssRules.length)\n      } catch (e) {\n        if (process.env.NODE_ENV !== 'production') {\n          console.warn(\n            `There was a problem inserting the following rule: \"${rule}\"`,\n            e\n          )\n        }\n      }\n    } else {\n      tag.appendChild(document.createTextNode(rule))\n    }\n    this.ctr++\n  }\n  flush() {\n    // $FlowFixMe\n    this.tags.forEach(tag => tag.parentNode.removeChild(tag))\n    this.tags = []\n    this.ctr = 0\n  }\n}\n"],"names":["StyleSheet","options","undefined","isSpeedy","speedy","maxLength","this","tags","ctr","nonce","key","container","document","head","insert","rule","tag","createElement","setAttribute","appendChild","createTextNode","push","length","sheet","i","styleSheets","ownerNode","sheetForTag","insertRule","cssRules","e","flush","forEach","parentNode","removeChild"],"mappings":"mMAkDaA,EAAb,sBAQcC,QACMC,IAAZD,IAAuBA,EAAU,SAChCE,cACgBD,IAAnBD,EAAQG,QAEJH,EAAQG,YAKTC,UAAYJ,EAAQI,WAAaC,KAAKH,SAAW,KAAQ,OACzDI,KAAO,QACPC,IAAM,OACNC,MAAQR,EAAQQ,WAEhBC,IAAMT,EAAQS,KAAO,QACrBC,UACHV,EAAQU,YAEa,oBAAbC,SAA2BA,SAASC,KAAO,iCAEvDC,gBAAOC,MACDT,KAAKE,IAAMF,KAAKD,WAAc,EAAG,KAC/BW,EAAMJ,SAASK,cAAc,WAC7BC,aAAa,eAAgBZ,KAAKI,UACnBR,IAAfI,KAAKG,SACHS,aAAa,QAASZ,KAAKG,SAE7BU,YAAYP,SAASQ,eAAe,UACnCT,UAAUQ,YAAYH,QACtBT,KAAKc,KAAKL,OAEXA,EAAMV,KAAKC,KAAKD,KAAKC,KAAKe,OAAS,MAErChB,KAAKH,SAAU,KACXoB,EAnEZ,SAAqBP,MACfA,EAAIO,aAECP,EAAIO,UAKR,IAAIC,EAAI,EAAGA,EAAIZ,SAASa,YAAYH,OAAQE,OAC3CZ,SAASa,YAAYD,GAAGE,YAAcV,SAEjCJ,SAASa,YAAYD,GAwDdG,CAAYX,SAIlBY,WAAWb,EAAMQ,EAAMM,SAASP,QACtC,MAAOQ,YASLX,YAAYP,SAASQ,eAAeL,SAErCP,SAEPuB,sBAEOxB,KAAKyB,QAAQ,mBAAOhB,EAAIiB,WAAWC,YAAYlB,UAC/CT,KAAO,QACPC,IAAM,KAjEf"}